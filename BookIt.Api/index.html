<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Product App</title>
</head>
<body>
  <div>
    <h2>Add user to waiting list</h2>
    <input type="text" id="userId"/>
    <input type="text" id="resourceId"/>

    <input type="button" id="addUserToLine" value="Add" />
    
    <p id="message"></p>
  </div>
  
  <div>
    <h2>Waiting list</h2>
    <ul id="waitlist" />
  </div>

  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
  <script>
    var uri = 'api/waitlist';

    $(document).ready(function () {
      function refreshList() {
        $('#waitlist').html('');
        $.getJSON(uri)
          .done(function (data) {
            $.each(data, function (key, item) {
              if (item != null) {
                $('<li>', {
                  text: formatItem(item)
                }).appendTo($('#waitlist'));
              }
            });
          });
      }

      refreshList();
      
      function formatItem(item) {
        return item.User.FullName + ' booked ' + item.HubResource.Name + ' at ' + item.BookedTime;
      }

      var addToLine = function () {
        var query = '?userId=' + $('#userId').val() + '&resourceId=' + $('#resourceId').val();
        $.post(uri + query, 
          function (data) {
            if (data != null) {
              $('#message').text(formatItem(data));
              refreshList();
            }
          },
          'json');
      };

      $('#addUserToLine').click(addToLine);
    });

    
  </script>
</body>
</html>